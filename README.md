# HistoryMap - –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –°–°–°–†

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –≤–µ–±-–∫–∞—Ä—Ç–∞ –°–°–°–† (1920-1991), –≥–¥–µ —Ä–µ–≥–∏–æ–Ω—ã –æ–∫—Ä–∞—à–∏–≤–∞—é—Ç—Å—è –ø–æ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º—É –æ–∫—Ä–∞—Å—É –¥–Ω–µ–≤–Ω–∏–∫–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π —Ç–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –≥–æ–¥ ‚Üí –∫–∞—Ä—Ç–∞ –º–µ–Ω—è–µ—Ç —Ü–≤–µ—Ç–∞ ‚Üí –∫–ª–∏–∫ –Ω–∞ —Ä–µ–≥–∏–æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç—ã –¥–Ω–µ–≤–Ω–∏–∫–æ–≤ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —ç–º–æ—Ü–∏–π.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üó∫Ô∏è –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –°–°–°–† –Ω–∞ –±–∞–∑–µ Leaflet
- üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –æ–∫—Ä–∞—Å–∫–∏ –¥–Ω–µ–≤–Ω–∏–∫–æ–≤ (—Å—Ç—Ä–∞—Ö/—Ä–∞–¥–æ—Å—Ç—å/–Ω–µ–π—Ç—Ä–∞–ª—å/–≥—Ä—É—Å—Ç—å)
- üìÖ –°–ª–∞–π–¥–µ—Ä –≥–æ–¥–æ–≤ —Å 1920 –ø–æ 1991
- üìù –î–Ω–µ–≤–Ω–∏–∫–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –∏–∑ –∞—Ä—Ö–∏–≤–∞ "–ü—Ä–æ–∂–∏—Ç–æ"
- üìà –ì—Ä–∞—Ñ–∏–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–∞—Å–µ–ª–µ–Ω–∏—è –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —ç–º–æ—Ü–∏–π
- üé® –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

## Tech Stack

### Backend
- **FastAPI** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **SQLAlchemy + aiosqlite** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- **transformers** - ML –º–æ–¥–µ–ª–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–∞
- **BeautifulSoup4** - –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö —Å prozhito.org

### Frontend
- **React 18** - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- **Vite** - –±—ã—Å—Ç—Ä—ã–π —Å–±–æ—Ä—â–∏–∫
- **TailwindCSS** - —É—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–µ CSS –∫–ª–∞—Å—Å—ã
- **react-leaflet** - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞—Ä—Ç—ã
- **Recharts** - –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –¥–∏–∞–≥—Ä–∞–º–º—ã
- **Vitest** - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
HistoryMap/
‚îú‚îÄ‚îÄ backend/               # FastAPI backend
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py       # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py     # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schemas.py    # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–î
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py     # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routers/      # API endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/     # ML –∏ Scraper —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/        # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ tests/            # –¢–µ—Å—Ç—ã backend
‚îÇ   ‚îî‚îÄ‚îÄ pyproject.toml    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ frontend/             # React frontend
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/   # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/     # API –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.jsx       # –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.jsx      # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ urss.geojson  # GeoJSON –∫–∞—Ä—Ç–∞ –°–°–°–†
‚îÇ   ‚îú‚îÄ‚îÄ tests/            # –¢–µ—Å—Ç—ã frontend
‚îÇ   ‚îî‚îÄ‚îÄ package.json      # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Node.js
‚îú‚îÄ‚îÄ docker-compose.yml    # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ .env.example          # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ README.md             # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –° –ø–æ–º–æ—â—å—é Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è**

```bash
git clone <repository-url>
cd HistoryMap
```

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**

```bash
cp .env.example .env
```

–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` —Ñ–∞–π–ª.

3. **–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤**

```bash
docker-compose up --build
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É:
- Frontend: http://localhost:5173
- Backend API: http://localhost:8000
- API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8000/docs

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

#### Backend

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**

```bash
cd backend
pip install -e .
```

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**

```bash
cp ../.env.example .env
```

3. **–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞**

```bash
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

#### Frontend

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**

```bash
cd frontend
npm install
```

2. **–ó–∞–ø—É—Å–∫ dev —Å–µ—Ä–≤–µ—Ä–∞**

```bash
npm run dev
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Backend —Ç–µ—Å—Ç—ã

```bash
cd backend
pytest tests/ -v
```

### Frontend —Ç–µ—Å—Ç—ã

```bash
cd frontend
npm test
```

### –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º (coverage)

```bash
# Backend
cd backend
pytest tests/ --cov=app --cov-report=html

# Frontend
cd frontend
npm run test:coverage
```

## API Endpoints

### GET /api/health
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞.

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "ok",
  "version": "0.1.0"
}
```

### GET /api/map/{year}
–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≥–æ–¥–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `year` (path) - –ì–æ–¥ –æ—Ç 1920 –¥–æ 1991

**–û—Ç–≤–µ—Ç:**
```json
{
  "year": 1941,
  "regions": [
    {
      "name": "–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
      "geo_id": "ru-mo",
      "emotions": {
        "fear": 0.62,
        "joy": 0.12,
        "neutral": 0.26,
        "sadness": 0.10
      },
      "diary_count": 14
    }
  ]
}
```

### GET /api/region/{year}/{region_name}
–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–≥–∏–æ–Ω–µ.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `year` (path) - –ì–æ–¥ –æ—Ç 1920 –¥–æ 1991
- `region_name` (path) - –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–∞

**–û—Ç–≤–µ—Ç:**
```json
{
  "name": "–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
  "year": 1941,
  "emotions": {
    "fear": 0.62,
    "joy": 0.12,
    "neutral": 0.26,
    "sadness": 0.10
  },
  "diary_entries": [
    {
      "text": "22 –∏—é–Ω—è. –ù–µ–º—Ü—ã –±–æ–º–±—è—Ç...",
      "author": "–ê–≤—Ç–æ—Ä 1234",
      "date": "22.06.1941",
      "url": "https://prozhito.org/n/12345"
    }
  ],
  "stats": {
    "population": 5000000,
    "change_percent": -5.0,
    "year": 1941
  }
}
```

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö

- **–ö–∞—Ä—Ç–∞:** GeoJSON —Ñ–∞–π–ª —Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ —Ä–µ–≥–∏–æ–Ω–æ–≤ –°–°–°–†
- **–î–Ω–µ–≤–Ω–∏–∫–∏:** [prozhito.org](https://prozhito.org) - –∞—Ä—Ö–∏–≤ –¥–Ω–µ–≤–Ω–∏–∫–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π
- **ML –º–æ–¥–µ–ª—å:** [seara/rubert-tiny-sentiment](https://huggingface.co/seara/rubert-tiny-sentiment) - –º–æ–¥–µ–ª—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Ä—É—Å—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–º. `.env.example`):

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `DATABASE_URL` | URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | `sqlite+aiosqlite:///./data/historymap.db` |
| `ML_MODEL_NAME` | –ù–∞–∑–≤–∞–Ω–∏–µ ML –º–æ–¥–µ–ª–∏ | `seara/rubert-tiny-sentiment` |
| `CACHE_TTL` | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∞ (—Å–µ–∫) | `86400` |
| `VITE_API_URL` | URL API –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ | `http://localhost:8000` |

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —ç–º–æ—Ü–∏–π

1. –û–±–Ω–æ–≤–∏—Ç–µ `app/services/ml_service.py` –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
2. –ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ö–µ–º—É –≤ `app/schemas.py`
3. –û–±–Ω–æ–≤–∏—Ç–µ —Ü–≤–µ—Ç–æ–≤—É—é –ø–∞–ª–∏—Ç—Ä—É –≤ `frontend/tailwind.config.js`
4. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ —Ü–≤–µ—Ç–∞ –≤ `frontend/src/components/EmotionLegend.jsx`

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π scraper –≤ `app/services/scraper.py`
2. –û–±–Ω–æ–≤–∏—Ç–µ `app/routers/map.py` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
3. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã –≤ `backend/tests/test_scraper.py`

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ ML –∞–Ω–∞–ª–∏–∑–∞ –∏ —Å–∫—Ä–∞–ø–∏–Ω–≥–∞ –≤ SQLite
- Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è ML –º–æ–¥–µ–ª–µ–π (10 —Ç–µ–∫—Å—Ç–æ–≤ –∑–∞ —Ä–∞–∑)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è API
- Lazy loading –¥–ª—è GeoJSON

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## –ê–≤—Ç–æ—Ä—ã

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –∫–æ–º–∞–Ω–¥–æ–π –∏–∑ 3 junior —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
- ML Engineer: –ê–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–∞
- Backend: API –∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- Frontend: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞

---

**–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è:**
- [simplemaps.com](https://simplemaps.com/country/ru/) - —Å—Ç–∏–ª—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ä—Ç—ã
- [–ü—Ä–æ–∂–∏—Ç–æ](https://prozhito.org) - –∞—Ä—Ö–∏–≤ –¥–Ω–µ–≤–Ω–∏–∫–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π
